# 预测系统后端文档

## 项目概述

这是一个基于 Go 语言开发的高性能预测系统后端，采用现代化的微服务架构和最佳实践。

## 技术架构

### 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                    客户端层                                  │
│  Vue.js 前端    │  移动端APP  │  管理后台  │  第三方集成      │
└─────────────────┬───────────────────┬─────────────────────────┘
                  │                   │
┌─────────────────┴───────────────────┴─────────────────────────┐
│                  API 网关层                                   │
│  Nginx + 路由规则 + 限流 + 认证 + API 版本管理                │
└─────────────────┬───────────────────────────────────────────┘
                  │
┌─────────────────┴───────────────────────────────────────────┐
│                微服务应用层                                  │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐│
│ │  核心服务    │ │  实时服务    │ │  通知服务    │ │  分析服务    ││
│ │ (REST API)  │ │(WebSocket)  │ │ (推送/邮件)  │ │ (统计报表)   ││
│ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘│
└─────────────────┬───────────────────────────────────────────┘
                  │
┌─────────────────┴───────────────────────────────────────────┐
│                  数据和缓存层                                │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐│
│ │   MySQL     │ │    Redis    │ │  消息队列    │ │  文件存储    ││
│ │  (主数据)    │ │   (缓存)    │ │ (RabbitMQ)  │ │ (MinIO/S3)  ││
│ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘│
└─────────────────────────────────────────────────────────────┘
```

### 技术栈

- **后端框架**: Go 1.21 + Gin
- **数据库**: MySQL 8.0 + GORM
- **缓存**: Redis 6.0
- **实时通信**: WebSocket (Gorilla)
- **认证**: JWT + bcrypt
- **配置管理**: Viper
- **日志**: Logrus (结构化日志)
- **API 文档**: Swagger/OpenAPI 3.0
- **容器化**: Docker + Docker Compose

## 项目结构

```
backend-go/
├── cmd/                     # 应用程序入口
│   ├── api/                 # API 服务
│   ├── websocket/           # WebSocket 服务
│   └── worker/              # 后台任务服务
├── internal/                # 私有应用代码
│   ├── core/                # 核心业务逻辑
│   │   ├── domain/          # 领域模型
│   │   │   ├── user/        # 用户领域
│   │   │   ├── match/       # 比赛领域
│   │   │   ├── prediction/  # 预测领域
│   │   │   └── shared/      # 共享组件
│   │   └── ports/           # 端口（接口）
│   ├── adapters/            # 适配器实现
│   │   ├── http/            # HTTP 适配器
│   │   ├── persistence/     # 持久化适配器
│   │   └── external/        # 外部服务适配器
│   ├── config/              # 配置管理
│   └── shared/              # 共享组件
├── pkg/                     # 公共库代码
├── api/                     # API 定义
├── migrations/              # 数据库迁移
├── scripts/                 # 脚本文件
├── deployments/             # 部署配置
├── tests/                   # 测试文件
├── docs/                    # 文档
├── docker-compose.yml
├── Dockerfile
└── go.mod
```

## 核心功能

### 1. 用户管理
- 用户注册和登录
- JWT 认证和授权
- 用户资料管理
- 积分系统

### 2. 比赛管理
- 比赛创建和管理
- 比赛状态跟踪
- 比赛结果设置

### 3. 预测系统
- 预测创建和修改
- 预测投票机制
- 积分计算
- 精选预测

### 4. 实时通信
- WebSocket 连接管理
- 实时状态更新
- 事件广播

### 5. 排行榜
- 用户积分排行
- 缓存优化
- 实时更新

## 开发指南

### 环境要求

- Go 1.21+
- MySQL 8.0+
- Redis 6.0+
- Docker & Docker Compose

### 快速开始

1. **克隆项目**
```bash
git clone <repository-url>
cd backend-go
```

2. **安装依赖**
```bash
make deps
```

3. **启动开发环境**
```bash
make dev
```

4. **运行测试**
```bash
make test
```

5. **构建项目**
```bash
make build
```

### 开发工具

- **代码格式化**: `make fmt`
- **代码检查**: `make lint`
- **生成文档**: `make docs`
- **热重载**: `air`

## API 文档

启动服务后，访问以下地址查看 API 文档：

- Swagger UI: http://localhost:8080/swagger/index.html
- API JSON: http://localhost:8080/swagger/doc.json

## 部署

### Docker 部署

```bash
# 构建镜像
make docker-build

# 启动服务
make docker-up

# 查看日志
make docker-logs

# 停止服务
make docker-down
```

### 生产环境

1. 设置环境变量
2. 配置数据库和 Redis
3. 运行数据库迁移
4. 启动服务

## 性能指标

- **响应时间**: < 100ms (P95)
- **并发连接**: 2000+
- **内存占用**: < 500MB
- **启动时间**: < 5s

## 监控和日志

- 结构化日志 (JSON 格式)
- 性能指标收集
- 健康检查端点
- 错误追踪

## 贡献指南

1. Fork 项目
2. 创建功能分支
3. 提交代码
4. 运行测试
5. 创建 Pull Request

## 许可证

MIT License